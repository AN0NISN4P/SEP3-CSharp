@page "/OrderCard"
@* @attribute [Authorize(Policy = "SecurityLevel1")] *@
@using Entities.Models
@using Blazor.Data
@using ItemLocationSelectorComponent
@inject DialogService DialogService
@inject IOrderHandler _orderHandler

@if (Order == null)
{
    <p>Loading...........</p>
}
else if (!Order.OrderEntries.Any())
{
    <p>No Locations ;(</p>
}
else
{
    <RadzenCard Style="margin-bottom: 20px;">
        <div class="row">
            <div class="col-md-12">
                <h3>Order Details</h3>
                <RadzenDataGrid AllowFiltering="true" AllowPaging="true" AllowSorting="true" FilterCaseSensitivity="FilterCaseSensitivity.CaseInsensitive"
                                Data="@Order.OrderEntries" TItem="OrderEntry" ColumnWidth="100px">
                    <Columns>
                        <RadzenDataGridColumn Width="10%" TItem="OrderEntry" Property="Item.ItemName" Title="Item Name"/>
                        <RadzenDataGridColumn TItem="OrderEntry"  Title="SelectLocation">
                            <Template Context="data">
                            <ItemLocationSelector ShowLocationDetail="true" ShowItemDetails="false" 
                                                  ItemId="data.Item.Id"
                                                  InventoryChange="InventoryChanged" AmountChange="AmountChanged"/>
                            </Template>
                        </RadzenDataGridColumn>
                        
                        
                        <RadzenDataGridColumn Width="10%" TItem="OrderEntry" Property="Amount" Title="Amount"/>
                        <RadzenDataGridColumn TItem="Inventory" Title="Packed" Context="data" Filterable="false" Sortable="false" TextAlign="TextAlign.Center" Width="100px">
                            <Template Context="data">
                                <RadzenNumeric TValue="int" Min="0" Max="10" Change=@(args => OnChange(args, "amount"))></RadzenNumeric>
                            </Template>
                        </RadzenDataGridColumn>
                    </Columns>
                </RadzenDataGrid>
            </div>
        </div>
    </RadzenCard>
}