@page "/AddItem"
@using Entities.Models
@using Blazor.Data

@inject IItemHandler _itemsHandler
@inject ILocationHandler _locationsHandler
@inject IItemLocationHandler _itemLocationHandler
@inject NavigationManager _navigationManager

<h3>AddItem</h3>

<div class="row">
    <div class="col-xl-10">
        <div class="row">
            <div class="col-xl-6 mb-5">
                <h5>Registered Items</h5>
                <RadzenDropDownDataGrid TValue="Item" FilterCaseSensitivity="FilterCaseSensitivity.CaseInsensitive" FilterOperator="StringFilterOperator.Contains"
                                        AllowFiltering="true" AllowClear="true" AllowVirtualization="true" Placeholder="Select"
                                        Data="@_items" TextProperty="ItemName" Change=@(args => OnChange(args, "Item")) Style="width:100%">
                    <Columns>
                        <RadzenDropDownDataGridColumn Property="Id" Title="Item Id"/>
                        <RadzenDropDownDataGridColumn Property="ItemName" Title="Item Name"/>
                    </Columns>
                </RadzenDropDownDataGrid>
            </div>
        </div>
        <div class="row">
            <div class="col-xl-6 mb-5">
                <h5>Registered Locations</h5>
                <RadzenDropDownDataGrid TValue="Location" FilterCaseSensitivity="FilterCaseSensitivity.CaseInsensitive" FilterOperator="StringFilterOperator.Contains"
                                        AllowFiltering="true" AllowClear="true" AllowVirtualization="true" Placeholder="Select"
                                        Data="@_locations" TextProperty="Description" Change=@(args => OnChange(args, "Location")) Style="width:100%">
                    <Columns>
                        <RadzenDropDownDataGridColumn Property="Id" Title="Description Id"/>
                        <RadzenDropDownDataGridColumn Property="Description" Title="Description"/>
                    </Columns>
                </RadzenDropDownDataGrid>
            </div>
        </div>
        <div class="row">
            
            <div class="col-md-2 mb-5">
                <RadzenNumeric TValue="int" @bind-Value="_itemLocation.Amount"></RadzenNumeric>
            </div>
            <div class="col-md-2 mb-5">
                <RadzenButton Click="@Save" Text="Save"/>
            </div>
        </div>

    </div>
</div>

@code {

    private IList<Item> _items;
    private IList<Location> _locations;

    private ItemLocation _itemLocation;

    protected override async Task OnInitializedAsync()
    {
        _items = await _itemsHandler.GetItems();
        _locations = await _locationsHandler.GetLocations();
        _itemLocation = new();
    }

    private async Task Save()
    {
        await _itemLocationHandler.AddItemLocation(_itemLocation);

        Console.WriteLine($"Printing Location: /n {_itemLocation}");

        _navigationManager.NavigateTo("https://www.youtube.com/watch?v=dQw4w9WgXcQ");
    }

    void OnChange(object value, string name)
    {
        Console.WriteLine($"value is: {value}");
        Console.WriteLine($"name is: {name}");
        var str = value is IEnumerable<object> ? string.Join(", ", (IEnumerable<object>) value) : value;

        Console.WriteLine($"{name} value changed to {str}");

        if (name.Equals("Item"))
        {
            Item item = (Item) value;

            _itemLocation.Item = item;
        }
        else if (name.Equals("Location"))
        {
            Location location = (Location) value;
            _itemLocation.Location = location;
        }
    }

}